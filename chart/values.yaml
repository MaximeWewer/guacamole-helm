# Default values for guacamole.
# This is a YAML-formatted file.

# -- Override chart name
nameOverride: ""
# -- Override full name
fullnameOverride: ""

# -- Common labels to add to all resources
commonLabels: {}
# -- Common annotations to add to all resources
commonAnnotations: {}

# =============================================================================
# Guacamole Client Configuration
# =============================================================================
guacamole:
  # -- Enable guacamole deployment
  enabled: true

  image:
    # -- Guacamole image repository
    repository: guacamole/guacamole
    # -- Guacamole image tag (defaults to appVersion)
    tag: ""
    # -- Image pull policy
    pullPolicy: IfNotPresent

  # -- Image pull secrets
  imagePullSecrets: []

  # -- Number of replicas
  replicaCount: 1

  # -- Webapp context path (use ROOT for /)
  webappContext: ROOT

  # -- Additional environment variables
  extraEnvVars: []
  # -- Additional environment variables from ConfigMap/Secret
  extraEnvFrom: []

  # -- Resource requests and limits
  resources:
    requests:
      memory: 256Mi
      cpu: 250m
    limits:
      memory: 512Mi
      cpu: 500m

  # -- Pod security context
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000

  # -- Container security context
  containerSecurityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL

  # -- Liveness probe configuration
  livenessProbe:
    httpGet:
      path: /
      port: http
    initialDelaySeconds: 60
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  # -- Readiness probe configuration
  readinessProbe:
    httpGet:
      path: /
      port: http
    initialDelaySeconds: 30
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

  # -- Node selector
  nodeSelector: {}
  # -- Tolerations
  tolerations: []
  # -- Affinity rules
  affinity: {}
  # -- Pod anti-affinity preset (soft/hard/none)
  podAntiAffinityPreset: soft

  # -- Additional volume mounts
  extraVolumeMounts: []
  # -- Additional volumes
  extraVolumes: []

  # -- Termination grace period
  terminationGracePeriodSeconds: 30

  service:
    # -- Service type
    type: ClusterIP
    # -- Service port
    port: 8080
    # -- Service annotations
    annotations: {}

  pdb:
    # -- Enable PodDisruptionBudget
    enabled: false
    # -- Minimum available pods
    minAvailable: 1
    # -- Maximum unavailable pods (alternative to minAvailable)
    # maxUnavailable: 1

  hpa:
    # -- Enable HorizontalPodAutoscaler
    enabled: false
    # -- Minimum replicas
    minReplicas: 2
    # -- Maximum replicas
    maxReplicas: 10
    # -- Target CPU utilization percentage
    targetCPUUtilizationPercentage: 80
    # -- Target memory utilization percentage
    targetMemoryUtilizationPercentage: 80

# =============================================================================
# Guacd Configuration
# =============================================================================
guacd:
  # -- Enable guacd deployment
  enabled: true

  image:
    # -- Guacd image repository
    repository: guacamole/guacd
    # -- Guacd image tag (defaults to appVersion)
    tag: ""
    # -- Image pull policy
    pullPolicy: IfNotPresent

  # -- Image pull secrets
  imagePullSecrets: []

  # -- Number of replicas
  replicaCount: 1

  # -- Log level (trace, debug, info, warning, error)
  logLevel: info

  # -- Additional environment variables
  extraEnvVars: []
  # -- Additional environment variables from ConfigMap/Secret
  extraEnvFrom: []

  # -- Resource requests and limits
  resources:
    requests:
      memory: 256Mi
      cpu: 250m
    limits:
      memory: 512Mi
      cpu: 500m

  # -- Pod security context
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000

  # -- DNS Policy for guacd pods
  # Use "Default" to use the node's DNS (useful for Tailscale/Netbird/VPN)
  # Options: ClusterFirst (default), Default, ClusterFirstWithHostNet, None
  dnsPolicy: ""
  # -- Custom DNS configuration
  # Example for using node DNS with Tailscale/Netbird:
  #   dnsPolicy: "Default"
  # Example for custom DNS servers:
  #   dnsPolicy: "None"
  #   dnsConfig:
  #     nameservers:
  #       - 100.100.100.100  # Tailscale DNS
  #     searches:
  #       - tailnet-name.ts.net
  dnsConfig: {}

  # -- Container security context
  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    capabilities:
      drop:
        - ALL

  # -- Liveness probe configuration
  livenessProbe:
    tcpSocket:
      port: guacd
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  # -- Readiness probe configuration
  readinessProbe:
    tcpSocket:
      port: guacd
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

  # -- Node selector
  nodeSelector: {}
  # -- Tolerations
  tolerations: []
  # -- Affinity rules
  affinity: {}
  # -- Pod anti-affinity preset (soft/hard/none)
  podAntiAffinityPreset: soft

  # -- Additional volume mounts
  extraVolumeMounts: []
  # -- Additional volumes
  extraVolumes: []

  # -- Termination grace period
  terminationGracePeriodSeconds: 30

  service:
    # -- Service type
    type: ClusterIP
    # -- Service port
    port: 4822
    # -- Service annotations
    annotations: {}

  pdb:
    # -- Enable PodDisruptionBudget
    enabled: false
    # -- Minimum available pods
    minAvailable: 1

# =============================================================================
# Service Account Configuration
# =============================================================================
serviceAccount:
  # -- Create service accounts
  create: true
  # -- Service account annotations
  annotations: {}
  # -- Service account name (auto-generated if not set)
  name: ""

# =============================================================================
# RBAC Configuration
# =============================================================================
rbac:
  # -- Create RBAC resources (Role and RoleBinding)
  # The Role is intentionally empty (no permissions) as Guacamole pods
  # do not need any Kubernetes API access
  create: true

# =============================================================================
# Proxy Configuration
# =============================================================================
proxy:
  # -- Enable remote IP valve for reverse proxy
  enabled: true
  # -- Trusted proxy IP regex
  allowedIpsRegex: "127\\.0\\.0\\.1|::1|10\\..*|172\\.(1[6-9]|2[0-9]|3[0-1])\\..*|192\\.168\\..*"
  # -- IP header name
  ipHeader: X-Forwarded-For
  # -- Protocol header name
  protocolHeader: X-Forwarded-Proto

# =============================================================================
# Database Configuration
# =============================================================================
database:
  # -- Database type
  type: postgresql

  # -- Use external database (if false, uses subchart)
  external:
    # -- Enable external database
    enabled: false
    # -- External database hostname
    hostname: ""
    # -- External database port
    port: 5432
    # -- External database name
    database: guacamole
    # -- External database username
    username: guacamole
    # -- External database password (use existingSecret for production)
    password: ""
    # -- Existing secret with database credentials
    # Must contain keys: password (and optionally: username)
    existingSecret: ""
    # -- Key in existing secret for password
    existingSecretPasswordKey: password

  # -- Database initialization
  init:
    # -- Enable schema initialization (creates Job)
    enabled: true
    # -- Recreate schema on upgrade (DANGER: drops existing data)
    recreate: false
    # -- Image for schema generation (uses guacamole image)
    image:
      # -- Init job image repository
      repository: guacamole/guacamole
      # -- Init job image tag (defaults to appVersion)
      tag: ""
      # -- Image pull policy
      pullPolicy: IfNotPresent
    # -- Database client images for schema application
    # These images contain the CLI tools (psql, mysql, mariadb-client, sqlcmd)
    # Uses official Docker images
    clientImages:
      postgresql:
        repository: postgres
        tag: "18"
      mysql:
        repository: mysql
        tag: "9"
      mariadb:
        repository: mariadb
        tag: "12"
      sqlserver:
        repository: mcr.microsoft.com/mssql/server
        tag: "2025-latest"
    # -- Resources for init job
    resources:
      requests:
        memory: 128Mi
        cpu: 100m
      limits:
        memory: 256Mi
        cpu: 200m
    # -- Init job backoff limit
    backoffLimit: 3
    # -- Time to live after completion (seconds)
    ttlSecondsAfterFinished: 300
    # -- Use Helm hooks (pre-install, pre-upgrade) instead of init containers
    # Note: Hooks run BEFORE database is deployed, so this only works with external databases
    # For subchart databases (postgresql.enabled=true), use init containers (useHooks=false)
    useHooks: false
    # -- Hook weight (lower runs first)
    hookWeight: "-5"
    # -- Hook delete policy
    hookDeletePolicy: before-hook-creation,hook-succeeded

# PostgreSQL configuration (official Docker image)
postgresql:
  # -- Enable PostgreSQL deployment
  enabled: true
  image:
    # -- PostgreSQL image repository (official Docker image)
    repository: postgres
    # -- PostgreSQL image tag
    tag: "18"
    # -- Image pull policy
    pullPolicy: IfNotPresent
  # -- Image pull secrets
  imagePullSecrets: []
  auth:
    # -- PostgreSQL database name
    database: guacamole
    # -- PostgreSQL username
    username: guacamole
    # -- PostgreSQL password (auto-generated if not set)
    password: ""
    # -- Existing secret with PostgreSQL password (key: password)
    existingSecret: ""
  service:
    # -- Service type
    type: ClusterIP
    # -- Service port
    port: 5432
  persistence:
    # -- Enable persistence
    enabled: true
    # -- Persistence size
    size: 8Gi
    # -- Storage class (empty for default)
    storageClass: ""
    # -- Access modes
    accessModes:
      - ReadWriteOnce
    # -- Annotations for PVC
    annotations: {}
  # -- Custom postgresql.conf configuration
  configuration: ""
  # -- Existing ConfigMap with custom configuration
  customConfigMap: ""
  # -- Resources for PostgreSQL
  resources: {}
  # -- Pod security context
  podSecurityContext:
    fsGroup: 999
  # -- Container security context
  containerSecurityContext:
    runAsUser: 999
    runAsGroup: 999
    runAsNonRoot: true
    allowPrivilegeEscalation: false
  # -- Startup probe configuration
  startupProbe:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 30
    successThreshold: 1
  # -- Liveness probe configuration
  livenessProbe:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 6
    successThreshold: 1
  # -- Readiness probe configuration
  readinessProbe:
    enabled: true
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 6
    successThreshold: 1
  # -- Termination grace period in seconds
  terminationGracePeriodSeconds: 120
  # -- Update strategy for StatefulSet
  updateStrategy:
    type: RollingUpdate
  # -- Priority class name
  priorityClassName: ""
  # -- Node selector
  nodeSelector: {}
  # -- Tolerations
  tolerations: []
  # -- Affinity rules
  affinity: {}
  # -- Pod anti-affinity preset (soft/hard/empty)
  podAntiAffinityPreset: ""
  # -- Pod annotations
  podAnnotations: {}
  # -- Pod labels
  podLabels: {}
  # -- StatefulSet annotations
  annotations: {}
  # -- Additional environment variables
  extraEnvVars: []
  # -- Additional environment variables from ConfigMap/Secret
  extraEnvFrom: []
  # -- Additional volume mounts
  extraVolumeMounts: []
  # -- Additional volumes
  extraVolumes: []
  # -- Init containers
  initContainers: []

# MySQL configuration (official Docker image)
mysql:
  # -- Enable MySQL deployment
  enabled: false
  image:
    # -- MySQL image repository (official Docker image)
    repository: mysql
    # -- MySQL image tag
    tag: "9"
    # -- Image pull policy
    pullPolicy: IfNotPresent
  # -- Image pull secrets
  imagePullSecrets: []
  auth:
    # -- MySQL database name
    database: guacamole
    # -- MySQL username
    username: guacamole
    # -- MySQL password (auto-generated if not set)
    password: ""
    # -- MySQL root password (auto-generated if not set)
    rootPassword: ""
    # -- Existing secret with MySQL passwords (keys: password, root-password)
    existingSecret: ""
  service:
    # -- Service type
    type: ClusterIP
    # -- Service port
    port: 3306
  persistence:
    # -- Enable persistence
    enabled: true
    # -- Persistence size
    size: 8Gi
    # -- Storage class (empty for default)
    storageClass: ""
    # -- Access modes
    accessModes:
      - ReadWriteOnce
    # -- Annotations for PVC
    annotations: {}
  # -- Custom my.cnf configuration
  configuration: ""
  # -- Existing ConfigMap with custom configuration
  customConfigMap: ""
  # -- Resources for MySQL
  resources: {}
  # -- Pod security context
  podSecurityContext:
    fsGroup: 999
  # -- Container security context
  containerSecurityContext:
    runAsUser: 999
    runAsGroup: 999
    runAsNonRoot: true
    allowPrivilegeEscalation: false
  # -- Startup probe configuration
  startupProbe:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 30
    successThreshold: 1
  # -- Liveness probe configuration
  livenessProbe:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 6
    successThreshold: 1
  # -- Readiness probe configuration
  readinessProbe:
    enabled: true
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 6
    successThreshold: 1
  # -- Termination grace period in seconds
  terminationGracePeriodSeconds: 120
  # -- Update strategy for StatefulSet
  updateStrategy:
    type: RollingUpdate
  # -- Priority class name
  priorityClassName: ""
  # -- Node selector
  nodeSelector: {}
  # -- Tolerations
  tolerations: []
  # -- Affinity rules
  affinity: {}
  # -- Pod anti-affinity preset (soft/hard/empty)
  podAntiAffinityPreset: ""
  # -- Pod annotations
  podAnnotations: {}
  # -- Pod labels
  podLabels: {}
  # -- StatefulSet annotations
  annotations: {}
  # -- Additional environment variables
  extraEnvVars: []
  # -- Additional environment variables from ConfigMap/Secret
  extraEnvFrom: []
  # -- Additional volume mounts
  extraVolumeMounts: []
  # -- Additional volumes
  extraVolumes: []
  # -- Init containers
  initContainers: []

# MariaDB configuration (official Docker image)
mariadb:
  # -- Enable MariaDB deployment
  enabled: false
  image:
    # -- MariaDB image repository (official Docker image)
    repository: mariadb
    # -- MariaDB image tag
    tag: "12"
    # -- Image pull policy
    pullPolicy: IfNotPresent
  # -- Image pull secrets
  imagePullSecrets: []
  auth:
    # -- MariaDB database name
    database: guacamole
    # -- MariaDB username
    username: guacamole
    # -- MariaDB password (auto-generated if not set)
    password: ""
    # -- MariaDB root password (auto-generated if not set)
    rootPassword: ""
    # -- Existing secret with MariaDB passwords (keys: password, root-password)
    existingSecret: ""
  service:
    # -- Service type
    type: ClusterIP
    # -- Service port
    port: 3306
  persistence:
    # -- Enable persistence
    enabled: true
    # -- Persistence size
    size: 8Gi
    # -- Storage class (empty for default)
    storageClass: ""
    # -- Access modes
    accessModes:
      - ReadWriteOnce
    # -- Annotations for PVC
    annotations: {}
  # -- Custom my.cnf configuration
  configuration: ""
  # -- Existing ConfigMap with custom configuration
  customConfigMap: ""
  # -- Resources for MariaDB
  resources: {}
  # -- Pod security context
  podSecurityContext:
    fsGroup: 999
  # -- Container security context
  containerSecurityContext:
    runAsUser: 999
    runAsGroup: 999
    runAsNonRoot: true
    allowPrivilegeEscalation: false
  # -- Startup probe configuration
  startupProbe:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 30
    successThreshold: 1
  # -- Liveness probe configuration
  livenessProbe:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 6
    successThreshold: 1
  # -- Readiness probe configuration
  readinessProbe:
    enabled: true
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 6
    successThreshold: 1
  # -- Termination grace period in seconds
  terminationGracePeriodSeconds: 120
  # -- Update strategy for StatefulSet
  updateStrategy:
    type: RollingUpdate
  # -- Priority class name
  priorityClassName: ""
  # -- Node selector
  nodeSelector: {}
  # -- Tolerations
  tolerations: []
  # -- Affinity rules
  affinity: {}
  # -- Pod anti-affinity preset (soft/hard/empty)
  podAntiAffinityPreset: ""
  # -- Pod annotations
  podAnnotations: {}
  # -- Pod labels
  podLabels: {}
  # -- StatefulSet annotations
  annotations: {}
  # -- Additional environment variables
  extraEnvVars: []
  # -- Additional environment variables from ConfigMap/Secret
  extraEnvFrom: []
  # -- Additional volume mounts
  extraVolumeMounts: []
  # -- Additional volumes
  extraVolumes: []
  # -- Init containers
  initContainers: []

# SQL Server configuration (embedded templates)
sqlserver:
  # -- Enable SQL Server deployment
  enabled: false
  image:
    # -- SQL Server image repository
    repository: mcr.microsoft.com/mssql/server
    # -- SQL Server image tag
    tag: "2025-latest"
    # -- Image pull policy
    pullPolicy: IfNotPresent
  # -- SQL Server edition (Developer, Express, Standard, Enterprise)
  edition: Developer
  # -- Accept EULA (required)
  acceptEula: "Y"
  # -- Enable SQL Agent
  agentEnabled: true
  auth:
    # -- SA password (use existingSecret for production)
    saPassword: ""
    # -- Database name for Guacamole
    database: guacamole
    # -- Username for Guacamole
    username: guacamole
    # -- Password for Guacamole user
    password: ""
    # -- Existing secret with SQL Server credentials
    # Must contain keys: sa-password, password
    existingSecret: ""
  service:
    # -- Service type
    type: ClusterIP
    # -- Service port
    port: 1433
  persistence:
    # -- Enable persistence
    enabled: true
    # -- Storage size
    size: 8Gi
    # -- Storage class (empty for default)
    storageClass: ""
  resources:
    requests:
      memory: 2Gi
      cpu: 500m
    limits:
      memory: 4Gi
      cpu: 2000m

# =============================================================================
# Authentication Configuration
# =============================================================================
auth:
  # -- Enable database authentication (always enabled when database configured)
  database:
    enabled: true

  # -- LDAP authentication
  ldap:
    # -- Enable LDAP authentication
    enabled: false
    # -- LDAP server hostname
    hostname: ""
    # -- LDAP server port
    port: 389
    # -- LDAP encryption (none, ssl, starttls)
    encryption: none
    # -- User base DN
    userBaseDn: ""
    # -- Username attribute
    usernameAttribute: uid
    # -- Search bind DN (optional)
    searchBindDn: ""
    # -- Search bind password (use existingSecret for production)
    searchBindPassword: ""
    # -- Existing secret with LDAP bind password
    existingSecret: ""
    # -- Additional LDAP configuration
    extraConfig: {}

  # -- OpenID Connect authentication
  oidc:
    # -- Enable OIDC authentication
    enabled: false
    # -- Authorization endpoint URL
    authorizationEndpoint: ""
    # -- Issuer URL
    issuer: ""
    # -- JWKS endpoint URL
    jwksEndpoint: ""
    # -- Client ID
    clientId: ""
    # -- Client secret (use existingSecret for production)
    clientSecret: ""
    # -- Existing secret with OIDC client credentials
    existingSecret: ""
    # -- Redirect URI
    redirectUri: ""
    # -- Scopes
    scope: openid profile email
    # -- Username claim
    usernameClaim: preferred_username
    # -- Additional OIDC configuration
    extraConfig: {}

  # -- SAML authentication
  saml:
    # -- Enable SAML authentication
    enabled: false
    # -- IdP metadata URL
    idpMetadataUrl: ""
    # -- Entity ID
    entityId: ""
    # -- Callback URL
    callbackUrl: ""
    # -- Existing secret with SAML credentials
    existingSecret: ""
    # -- Additional SAML configuration
    extraConfig: {}

  # -- TOTP (Two-Factor) authentication
  totp:
    # -- Enable TOTP
    enabled: false
    # -- Issuer name shown in authenticator apps
    issuer: Apache Guacamole
    # -- Key length (16, 24, or 32)
    keyLength: 32
    # -- TOTP mode (required or optional)
    mode: optional

  # -- Duo two-factor authentication
  duo:
    # -- Enable Duo 2FA
    enabled: false
    # -- Duo API hostname (e.g., api-xxxxxxxx.duosecurity.com)
    apiHostname: ""
    # -- Duo client ID
    clientId: ""
    # -- Duo client secret (use existingSecret for production)
    clientSecret: ""
    # -- Existing secret with Duo credentials (key: client-secret)
    existingSecret: ""
    # -- Redirect URI for Duo callback
    redirectUri: ""
    # -- Authentication timeout in minutes
    authTimeout: 5
    # -- Comma-separated IPs/subnets to bypass Duo
    bypassHosts: ""
    # -- Comma-separated IPs/subnets that must use Duo
    enforceHosts: ""

  # -- RADIUS authentication
  radius:
    # -- Enable RADIUS authentication
    enabled: false
    # -- RADIUS server hostname
    hostname: localhost
    # -- RADIUS authentication port
    authPort: 1812
    # -- RADIUS shared secret (use existingSecret for production)
    sharedSecret: ""
    # -- Existing secret with RADIUS shared secret (key: shared-secret)
    existingSecret: ""
    # -- Authentication protocol (pap, chap, mschapv1, mschapv2, eap-md5, eap-tls, eap-ttls)
    authProtocol: pap
    # -- Connection retries
    retries: 5
    # -- Connection timeout in seconds
    timeout: 60
    # -- Trust all certificates (not recommended for production)
    trustAll: false
    # -- Network Access Server IP (auto-detected if empty)
    nasIp: ""
    # -- EAP-TTLS inner protocol
    eapTtlsInnerProtocol: ""
    # -- Path to client key file (for EAP-TLS)
    keyFile: ""
    # -- Key file type (pem, jceks, jks, pkcs12)
    keyType: ""
    # -- Key file password
    keyPassword: ""
    # -- Path to CA file
    caFile: ""
    # -- CA file type (pem, jceks, jks, pkcs12)
    caType: ""
    # -- CA file password
    caPassword: ""

  # -- CAS (Central Authentication Service) SSO
  cas:
    # -- Enable CAS authentication
    enabled: false
    # -- CAS server authorization endpoint (e.g., https://cas.example.com/cas/)
    authorizationEndpoint: ""
    # -- Redirect URI for CAS callback (Guacamole base URL)
    redirectUri: ""
    # -- Path to private key for ClearPass password decryption
    clearpassKey: ""
    # -- CAS attribute for group membership
    groupAttribute: ""
    # -- Group name format (plain or ldap)
    groupFormat: plain
    # -- LDAP base DN for group filtering
    groupLdapBaseDn: ""
    # -- LDAP attribute for group filtering
    groupLdapAttribute: ""

  # -- JSON authentication (encrypted/signed JSON tokens)
  json:
    # -- Enable JSON authentication
    enabled: false
    # -- 128-bit secret key as 32-character hex string (use existingSecret for production)
    secretKey: ""
    # -- Existing secret with JSON secret key (key: secret-key)
    existingSecret: ""

  # -- HTTP Header authentication (for reverse proxy integration)
  header:
    # -- Enable HTTP header authentication
    enabled: false
    # -- HTTP header containing authenticated username
    httpAuthHeader: REMOTE_USER

  # -- SSL/Certificate authentication
  ssl:
    # -- Enable SSL certificate authentication
    enabled: false
    # -- URI requiring client certificate
    authUri: ""
    # -- URI without client certificate requirement (for logout)
    primaryUri: ""
    # -- HTTP header containing URL-encoded client certificate
    clientCertificateHeader: X-Client-Certificate
    # -- HTTP header indicating certificate verification status
    clientVerifiedHeader: X-Client-Verified
    # -- Token validity duration in minutes
    maxTokenValidity: 5
    # -- LDAP attribute(s) from certificate DN to extract username
    subjectUsernameAttribute: ""
    # -- Base DN to restrict valid certificate subject DNs
    subjectBaseDn: ""
    # -- Temporary subdomain validity in minutes
    maxDomainValidity: 5

# =============================================================================
# Vault / Secrets Manager Configuration
# =============================================================================
vault:
  # -- Keeper Secrets Manager (KSM) integration
  ksm:
    # -- Enable KSM integration
    enabled: false
    # -- Base64-encoded KSM configuration (use existingSecret for production)
    config: ""
    # -- Existing secret with KSM config (key: ksm-config)
    existingSecret: ""
    # -- Allow users to configure their own KSM vaults
    allowUserConfig: false
    # -- Accept unverified certificates (not recommended for production)
    allowUnverifiedCert: false
    # -- Minimum milliseconds between API calls (to manage costs)
    apiCallInterval: ""
    # -- Strip Windows domain prefixes from usernames
    stripWindowsDomains: false

# =============================================================================
# QuickConnect Configuration (Ad-hoc Connections)
# =============================================================================
quickConnect:
  # -- Enable QuickConnect for ad-hoc connections
  enabled: false
  # -- Allowed parameters (whitelist, comma-separated)
  # Example: hostname,port,username,password
  allowedParameters: ""
  # -- Denied parameters (blacklist, comma-separated, takes precedence over allowed)
  # Example: file-transfer,drive-path,create-drive-path
  deniedParameters: ""

# =============================================================================
# Session Recording Configuration
# =============================================================================
recording:
  # -- Enable session recording
  enabled: false
  # -- Recording path inside guacd container
  path: /recordings
  # -- Create search index
  createRecordingIndex: true
  # -- Enable recording playback in web UI
  playback:
    # -- Enable playback feature
    enabled: false
    # -- Search path for recordings (must match recording path)
    searchPath: /recordings

  persistence:
    # -- Enable persistence for recordings
    enabled: false
    # -- Storage size
    size: 10Gi
    # -- Storage class (empty for default)
    storageClass: ""
    # -- Access modes
    accessModes:
      - ReadWriteOnce
    # -- Existing PVC name
    existingClaim: ""

# =============================================================================
# Ingress Configuration
# =============================================================================
ingress:
  # -- Enable ingress
  enabled: false
  # -- Ingress class name
  className: ""
  # -- Ingress annotations
  # Example annotations for nginx ingress with WebSocket support:
  # annotations:
  #   kubernetes.io/ingress.class: nginx
  #   cert-manager.io/cluster-issuer: letsencrypt-prod
  #   nginx.ingress.kubernetes.io/proxy-buffering: "off"
  #   nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
  #   nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
  annotations: {}

  # -- Ingress hosts
  hosts:
    - host: guacamole.local
      paths:
        - path: /
          pathType: Prefix

  # -- Ingress TLS configuration
  tls: []
  #  - secretName: guacamole-tls
  #    hosts:
  #      - guacamole.local

# =============================================================================
# Network Policy Configuration
# =============================================================================
networkPolicy:
  # -- Enable network policies
  enabled: false

  # -- Allow ingress from specific namespaces
  ingressNamespaceSelector: {}
  # -- Allow ingress from specific pods
  ingressPodSelector: {}

  # -- Additional ingress rules
  extraIngressRules: []
  # -- Additional egress rules
  extraEgressRules: []

# =============================================================================
# Logging Configuration
# =============================================================================
logging:
  # -- Guacamole log level
  guacamole:
    level: info
  # -- Guacd log level
  guacd:
    level: info

# =============================================================================
# API & Session Configuration
# =============================================================================
api:
  # -- API session settings
  session:
    # -- Session timeout in minutes (0 for no timeout)
    timeout: 60
    # -- Maximum concurrent connections per user (0 for unlimited)
    maxConnectionsPerUser: 0
    # -- Maximum concurrent connections total (0 for unlimited)
    maxConnections: 0

# =============================================================================
# Brute Force Protection
# =============================================================================
bruteForce:
  # -- Enable brute force protection
  enabled: true
  # -- Maximum failed login attempts before lockout
  maxAttempts: 5
  # -- Lockout duration in minutes
  lockoutDuration: 15
  # -- Time window for counting failed attempts (minutes)
  attemptWindow: 5

# =============================================================================
# Custom Extensions
# =============================================================================
extensions:
  # -- Enable custom extension loading
  enabled: false
  # -- List of extensions to download and install
  # Each extension should have a name and URL
  # extensions:
  #   - name: my-custom-extension
  #     url: https://example.com/my-extension.jar
  list: []
  # -- Extra volume mounts for custom extensions
  # Mount pre-built extensions from ConfigMaps or Secrets
  extraVolumeMounts: []
  # -- Extra volumes for custom extensions
  extraVolumes: []

# =============================================================================
# Advanced Guacamole Configuration
# =============================================================================
advanced:
  # -- GUACAMOLE_HOME directory (where config is stored)
  guacamoleHome: /etc/guacamole
  # -- Skip schema creation even if database.init.enabled is true
  skipSchemaCreation: false
  # -- Allowed file transfer paths (comma-separated)
  allowedFilePaths: ""
  # -- Enable WebSocket tunnel (recommended for performance)
  websocket:
    enabled: true
  # -- Tomcat configuration
  tomcat:
    # -- Maximum threads for Tomcat
    maxThreads: 200
    # -- Connection timeout in milliseconds
    connectionTimeout: 20000
